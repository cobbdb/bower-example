<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .panel{border:2px solid;position:absolute}
        #ir-head{border-color:blue}
        #ir-body{border-color:red}
        #ir-foot{border-color:green}
        html,body{height:100%;min-height:100%;margin:0}
        *{overflow:hidden;position:relative}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//underscorejs.org/underscore-min.js"></script>
    <script>
        var Functions = {
            accessor: function (obj, field) {
                return function (data) {
                    if (_(data).isUndefined()) {
                        return obj[field];
                    }
                    obj[field] = data;
                    return obj;
                };
            },
            mutator: function (obj, field, mutator) {
                return function (params) {
                    if (_(params).isUndefined()) {
                        return obj[field];
                    }
                    return mutator(params);
                };
            }
        };

        var Liquid = L = function (actual) {
            return {
                is: {
                    type: function (expected) {
                        var type = typeof(actual);
                        if (type !== expected.toLowerCase()) {
                            throw TypeError('Expected {' + expected + '} but found {' + type + '} instead.');
                        }
                    },
                    types: function (expected) {
                        for (var key in expected) {
                            var type = typeof(actual[key]);
                            if (type !== expected[key].toLowerCase()) {
                                throw TypeError('Expected ' + key + ' to be type {' + expected[key] + '} but found {' + type + '} instead.');
                            }
                        }
                    }
                }
            };
        };

        var Panel = function (unique) {
            var data = {
                count: {
                    unique: unique
                }
            };
            var Counter = function (data) {
                data.scale = function (tile) {
                    return {
                        width: data.width * tile,
                        height: data.height * tile
                    };
                };
                return data;
            };
            return function (id, common) {
                data.count.common = common;
                return {
                    count: Functions.mutator(data, 'count', function (upright) {
                        if (upright) {
                            return Counter({
                                width: data.count.common,
                                height: data.count.unique
                            });
                        } else {
                            return Counter({
                                width: data.count.unique,
                                height: data.count.common
                            });
                        }
                    }),
                    size: function (size) {
                        $(id)
                            .outerWidth(size.width)
                            .outerHeight(size.height)
                            .offset({
                                top: size.top,
                                left: size.left
                            });
                    }
                };
            };
        };

        function Frame(common, o) {
            var data = {
                size: {},
                panels: {
                    head: o.head('#ir-head', common),
                    body: o.body('#ir-body', common),
                    foot: o.foot('#ir-foot', common)
                }
            };
            var unique = _(data.panels).reduce(function (count, panel) {
                return count + panel.count().unique;
            }, 0);
            return {
                head: data.head,
                body: data.body,
                foot: data.foot,
                count: function (upright) {
                    if (upright) {
                        return {
                            width: common,
                            height: unique
                        };
                    } else {
                        return {
                            width: unique,
                            height: common
                        };
                    }
                },
                size: Functions.mutator(data, 'size', function (o) {
                    data.size = {
                        width: o.count.width * o.tile,
                        height: o.count.height * o.tile
                    };
                    _(data.panels).reduce(function (offset, panel) {
                        var dimensions = panel.count(o.upright).scale(o.tile);
                        panel.size({
                            width: dimensions.width,
                            height: dimensions.height,
                            top: offset.top,
                            left: offset.left
                        });
                        return {
                            top: offset.top + dimensions.height,
                            left: offset.left + dimensions.width
                        };
                    }, {
                        top: (o.window.height - data.size.height) / 2,
                        left: (o.window.width - data.size.width) / 2
                    });
                })
            };
        }

        var Screen = function (o) {
            return {
                max: o.max,
                window: o.window,
                size: {
                    width: Math.min(o.window.width, o.max.width),
                    height: Math.min(o.window.height, o.max.height)
                },
                upright: (o.window.height > o.window.width)
            };
        };

        var Tile = {};

        $(function () {
            var frame = Frame(10, {
                head: Panel(2),
                body: Panel(10),
                foot: Panel(4)
            });
            var heartbeat = setInterval(function () {
                var screen = Screen({
                    max: {
                        width: 1024,
                        height: 768
                    },
                    window: {
                        width: $(window).width(),
                        height: $(window).height()
                    }
                });

                var frameCount = frame.count(screen.upright);
                var tall = Math.floor(screen.size.height / frameCount.height);
                var wide = Math.floor(screen.size.width / frameCount.width);
                Tile.size = Math.min(tall, wide);

                frame.size({
                    upright: screen.upright,
                    window: screen.window,
                    tile: Tile.size,
                    count: frame.count(screen.upright)
                });
            }, 500);
        });
    </script>
</head>
<body>
    <div id="ir-head" class="panel"></div>
    <div id="ir-body" class="panel"></div>
    <div id="ir-foot" class="panel"></div>
</body>
</html>
