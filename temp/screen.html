<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .panel{border:2px solid;position:absolute}
        #game{border-color:red;left:0;top:0}
        #menu{border-color:green}
        html,body{height:100%;min-height:100%;margin:0}
        *{overflow:hidden;position:relative}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
        var heartbeat;

        var Functions = {
            accessor: function (obj, field) {
                return function (data) {
                    if (data) {
                        obj[field] = data;
                        return obj;
                    }
                    return obj[field];
                };
            },
            mutator: function (obj, field, mutator) {
                return function (o) {
                    if (mutator) {
                        return mutator(o);
                    }
                    return obj[field];
                };
            }
        };

        var Panel = function (id, unique) {
            var data = {
                id: id,
                count: {
                    unique: unique
                }
            };
            var Counter = function (data) {
                data.scale = function (tile) {
                    return {
                        width: data.width * tile,
                        height: data.height * tile
                    };
                };
                return data;
            };
            return function (common) {
                data.count.common = common;
                return {
                    count: function (upright) {
                        if (_(upright).isUndefined()) {
                            return data.count;
                        } else if (upright) {
                            return Counter({
                                width: data.count.common,
                                height: data.count.unique
                            });
                        } else {
                            return Counter({
                                width: data.count.unique,
                                height: data.count.common
                            });
                        }
                    },
                    size: function (size) {
                        $(data.id)
                            .outerWidth(size.width)
                            .outerHeight(size.height)
                            .offset({
                                top: size.top,
                                left: size.left
                            });
                    }
                };
            };
        };

        function Frame(common, o) {
            var data = {
                size: {},
                panels: {
                    head: o.head(common),
                    body: o.body(common),
                    foot: o.foot(common),
                    sumUnique: function () {
                        return _(data.panels).reduce(function (panel, count) {
                            return count + panel.count().unique;
                        }, 0);
                    }
                }
            };
            var getCount = function (upright) {
                if (upright) {
                    return {
                        width: common,
                        height: data.panels.sumUnique()
                    };
                } else {
                    return {
                        width: data.panels.sumUnique(),
                        height: common
                    };
                }
            };
            return {
                head: data.head,
                body: data.body,
                foot: data.foot,
                count: function (upright) {
                    if (_(upright).isBoolean()) {
                        return getCount(upright);
                    } else {
                        throw TypeError('{Constructor}:Frame - count() requires {Boolean}:upright');
                    }
                },
                size: Functions.mutator(data, 'size', function (o) {
                    data.size = {
                        width: o.count.width * o.tile,
                        height: o.count.height * o.tile
                    };
                    // Probably something like this?
                    _(data.panels).each(function (panel) {
                        var dimensions = panel.count(o.upright).scale(o.tile);
                        panel.size({
                            width: panel.width,
                            height: panel.height,
                            top: 0,
                            left: 0
                        });
                    });
                    // .. instead of this VV
                    var panel = data.head.count(o.upright).scale(o.tile);
                    data.head.size({
                        width: panel.width,
                        height: panel.height,
                        top: 0,
                        left: 0
                    });
                    panel = data.body.count(o.upright).scale(o.tile);
                    data.body.size({
                        width: panel.width,
                        height: panel.height,
                        top: 0,
                        left: 0
                    });
                    panel = data.foot.count(o.upright).scale(o.tile);
                    data.foot.size({
                        width: panel.width,
                        height: panel.height,
                        top: 0,
                        left: 0
                    });
                })
            };
        }

        var Screen = function (o) {
            return {
                max: o.max,
                window: o.window,
                size: {
                    width: Math.min(o.window.width, o.max.width),
                    height: Math.min(o.window.height, o.max.height)
                },
                upright: (o.window.height > o.window.width)
            };
        };

        var Tile = {};

        var frame = Frame(10, {
            head: Panel('#cap', 2),
            body: Panel('#game', 10),
            foot: Panel('#menu', 4)
        });

        $(function () {
            heartbeat = setInterval(function () {
                var screen = Screen({
                    max: {
                        width: 1024,
                        height: 768
                    },
                    window: {
                        width: $(window).width(),
                        height: $(window).height()
                    }
                });

                var frameCount = frame.count(screen.upright);
                var tall = Math.floor(screen.size.height / frameCount.height);
                var wide = Math.floor(screen.size.width / frameCount.width);
                Tile.size = Math.min(tall, wide);

                frame.size({
                    upright: screen.upright,
                    windowSize: screen.window,
                    tileSize: Tile.size
                });

                if (screen.upright) {
                    Panel.board.size({
                        top: (screen.window.height - Tile.size * (Panel.board.count() + Panel.menu.count())) / 2,
                        left: (screen.window.width - Tile.size * Panel.board.count()) / 2,
                        width: Tile.size * Panel.board.count(),
                        height: Tile.size * Panel.board.count()
                    });
                    Panel.menu.size({
                        top: Tile.size * Panel.board.count() + Panel.board.size().top,
                        left: Panel.board.size().left,
                        width: Tile.size * Panel.board.count(),
                        height: Tile.size * Panel.menu.count()
                    });
                } else {
                    Panel.board.size({
                        top: (screen.window.height - Tile.size * Panel.board.count()) / 2,
                        left: (screen.window.width - Tile.size * (Panel.board.count() + Panel.menu.count())) / 2,
                        width: Tile.size * Panel.board.count(),
                        height: Tile.size * Panel.board.count()
                    });
                    Panel.menu.size({
                        top: Panel.board.size().top,
                        left: Tile.size * Panel.board.count() + Panel.board.size().left,
                        width: Tile.size * Panel.menu.count(),
                        height: Tile.size * Panel.board.count()
                    });
                }

                $('#game')
                    .outerWidth(Panel.board.size().width)
                    .outerHeight(Panel.board.size().height)
                    .offset({
                        top: Panel.board.size().top,
                        left: Panel.board.size().left
                    });
                $('#menu')
                    .outerWidth(Panel.menu.size().width)
                    .outerHeight(Panel.menu.size().height)
                    .offset({
                        top: Panel.menu.size().top,
                        left: Panel.menu.size().left
                    });
            }, 500);
        });
    </script>
</head>
<body>
    <div id="cap" class="panel"></div>
    <div id="game" class="panel"></div>
    <div id="menu" class="panel"></div>
</body>
</html>
